<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/a11y-dark.min.css">

    <title>Hide post comments!</title>
  </head>
  <body>
    <div class="container">
      <h1>Hide post comments</h1>
<form>
  <div class="form-group">
    <label for="exampleInputEmail1">Facebook token*</label>
    <input type="text" required="required" class="form-control" value="" id="txtToken">
    <small id="emailHelp" class="form-text text-muted">How to get token: <a href="https://han-tools.com/fb-ca/access-token-how" target="_blank">See how</a>.</small>
  </div>
  <div class="form-group">
    <label for="exampleInputPassword1">Post ID*</label>
    <input type="number" required="required" value="" class="form-control" id="txtPostID">
  </div>

   <div class="form-group">
    <label for="exampleInputPassword1">Recheck interval:</label>
    <input type="checkbox" checked="true" id="autohide">  <br>Seconds:<input type="number" min="60" required="required" value="120" class="form-control" id="txtTime">
  </div> 
  <button id="btn_start" type="submit" class="btn btn-primary">Start</button>
</form>
<hr>
<pre id="log" style="height: 350px;overflow: scroll;"><code class="plaintext">
  --------------Anti comment dao----------------
  ------------------By LPDT---------------------
</code></pre>
    </div>
    


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
  <script>
  window.fbAsyncInit = function() {
    FB.init({
      appId            : '',
      autoLogAppEvents : true,
      xfbml            : true,
      version          : 'v6.0'
    });


       $(document).ready(function(){
         
          
       // loadcomments();
       
       })


  };
</script>
<script async defer src="https://connect.facebook.net/en_US/sdk.js"></script>


    <script>
      var comments = [];
      var access_token = '';
      var postID= '';
      var after ='';
      var page = 1;
     function Llog(message=''){
         $('#log code').append(message+'\n');
         var objDiv = document.getElementById("log");
          objDiv.scrollTop = objDiv.scrollHeight;
     }

      $(function(){
        $('form').submit(function(e){e.preventDefault()})

        $('#txtToken').change(function(){
         if($(this).val()!='') createCookie('accessToken', $(this).val()) ;


       });
        $('#txtToken').val(getCookie('accessToken'));

        hljs.initHighlightingOnLoad();
            $('#btn_start').click(function(e){
                access_token = $('#txtToken').val();
                postID= $('#txtPostID').val();
                if(access_token==''||postID=='') return;


            //get Page 

             FB.api(
              '/'+postID,
              'GET',
              {"fields":"from", "access_token":access_token},
              function(response) {
                  if(response.error) {Llog('Error :'+response.error.message); return;}
                  
                  //get Page Token
                  Llog('Getting page token ...')
                  FB.api(
                      '/'+response.from.id,
                      'GET',
                      {"fields":"access_token,name","access_token":access_token},
                      function(e){
                          if(e.error) {'Error :'+Llog(e.error.message); return;}
                          Llog('Page:'+e.name);
                          Llog('Scanning comments...');
                          access_token= e.access_token;
                          loadcomments();


                      }
                    );
              }
            );

            })

      })
      function loadcomments(){
        
          FB.api(
              '/'+postID+'/comments',
              'GET',
              {"fields":"can_hide,is_hidden,message,comments{comments,message,can_hide,is_hidden,from}",'limit':100,'after':after, "access_token":access_token},
              function(response) {
                 
                     for(let cmt of response.data){
                    if(!cmt.is_hidden && cmt.can_hide) comments.push([cmt.id,'hide',cmt.message]);
                    if(cmt.comments){
                        for(let subcmt of cmt.comments.data) {
                        if(!subcmt.is_hidden && subcmt.can_hide && subcmt.message.match(/\w{4}\.\w{2,5}\//))  comments.push([subcmt.id,'delete',subcmt.message]);          
                      }  
                    }
                    
                  
                  }

                  Llog('Page '+page+' has '+response.data.length+' comments. Processing '+comments.length);
                 after = (response.paging&&response.paging.cursors.after)?response.paging.cursors.after:'';
                 hide_comments();
              }
            );

          
      }

       function hide_comments(){
           if(comments.length==0) {
              if(after!=''){
                console.log('next page..');
                 page++;
                loadcomments(); return;
              }
              else 


               
               Llog('done');
               //reset
               page = 1;
               after ='';

                 if($('#autohide:checkbox:checked').length==1){
                
                   let intTime = parseInt( $('#txtTime').val());
                   let date = new Date();
                  Llog(date.getHours()+':'+date.getMinutes()+'| Recheck in '+intTime+' seconds...')
                   intTime = (intTime<60)?60*1000:intTime*1000;

                   setTimeout(loadcomments,intTime);
                 }

            return}

           let cID = comments.shift();
          if(cID[1]=='hide')
           FB.api(
              '/'+cID[0],
              'POST',
              {"is_hidden":"true",'access_token':access_token},
              function(response) {
                   Llog('Comment: '+cID[2]+' - Hide:'+response.success);
                   hide_comments();
              }
            );
         else 
          FB.api(
              '/'+cID[0],
              'DELETE',
              {'access_token':access_token},
              function(response) {
                   Llog('Comment: '+cID[2]+' - Delete:'+response.success);
                  hide_comments();
              }
            );

       }


       function createCookie(name, value, days =365) {
    var expires;
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toGMTString();
    }
    else {
        expires = "";
    }
    document.cookie = name + "=" + value + expires + "; path=/";
}

function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = document.cookie.length;
            }
            return unescape(document.cookie.substring(c_start, c_end));
        }
    }
    return "";
}
    
    
         
    </script>

   

  </body>
</html>